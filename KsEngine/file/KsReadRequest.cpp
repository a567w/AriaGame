/************************************************************************************************/
/**
 * @file		KsReadRequest.cpp
 * @brief		ファイルシステム
 * @author		Tsukasa Kato
 * @date		2004/03/30
 * @version		1.0.0
 */
/************************************************************************************************/

/*==============================================================================================*/
/*                                 << インクルード >>                                           */
/*==============================================================================================*/
#include "KsEngine/KsEnginePreCompile.h"

/*==============================================================================================*/
/*                                     << 定義 >>                                               */
/*==============================================================================================*/

/*==============================================================================================*/
/*                                     << 宣言 >>                                               */
/*==============================================================================================*/


/************************************************************************************************/
/*
 * コンストラクタ
 */
/************************************************************************************************/
KsReadRequest::KsReadRequest()
	: m_fileHandle( 0 )
	, m_threadHandle( 0 )
	, m_threadID( 0 )
	, m_bufferFlag( 0 )
	, m_bufferSize( 0 )
	, m_pBuffer( 0 )
	, m_status( ksREADING_START )
	, m_dataSize( 0 )
	, m_readSize( 0 )
	, m_callback( 0 )
	, m_pUserData( 0 )
	, m_callbackThread( 0 )
	, m_pUserDataThread( 0 )
	, m_bAutoDelete( ksTRUE )
{
	KsZeroMemory( &m_overlapped, sizeof(OVERLAPPED) );
}

/************************************************************************************************/
/*
 * デストラクタ
 */
/************************************************************************************************/
KsReadRequest::~KsReadRequest()
{
	if( m_bufferFlag )
	{
		ksDELETEARRAY( m_pBuffer );
	}
}

/************************************************************************************************/
/*
 *
 */
/************************************************************************************************/
void KsReadRequest::callback()
{
	if( m_callback )
	{
		(*m_callback)( m_pBuffer, m_readSize, m_pUserData );
	}
}

/************************************************************************************************/
/*
 *
 */
/************************************************************************************************/
void KsReadRequest::callbackThread()
{
	if( m_callbackThread )
	{
		(*m_callbackThread)( m_pBuffer, m_readSize, m_pUserDataThread );
	}
}

/************************************************************************************************/
/*
 * 読み込みようバッファをセットする(指定バッファを使用したいとき)
 */
/************************************************************************************************/
void KsReadRequest::setBuffer( KsUInt8* pBuffer, KsUInt32 bufferSize )
{
	m_bufferFlag = ksTRUE;
	m_pBuffer    = pBuffer;
	m_bufferSize = bufferSize;
}


