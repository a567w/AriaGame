/************************************************************************************************/
/** 
 * @file		KsMouse.cpp
 * @brief		マウス操作クラス
 * @author		Tsukasa Kato
 * @date		----/--/--
 * @since		----/--/--
 * @version		1.0
 */
/************************************************************************************************/

/*==============================================================================================*/
/*                                 << インクルード >>                                            */
/*==============================================================================================*/
#include "KsMouse.h"

/*==============================================================================================*/
/*                                     << 定義 >>                                               */
/*==============================================================================================*/

/*==============================================================================================*/
/*                                     << 宣言 >>                                               */
/*==============================================================================================*/

/************************************************************************************************/
/*
 *
 */
/************************************************************************************************/
KsMouse::KsMouse()
{
	m_x          = 0;
	m_y          = 0;
	m_z          = 0;
	m_button_now = 0;
	m_button_trg = 0;
	m_button_off = 0;
	m_button_old = 0;
	m_clickCount = 0;
	m_timer      = 0.0f;
	m_hWnd       = NULL;
}
/************************************************************************************************/
/*
 *
 */
/************************************************************************************************/
KsMouse::~KsMouse()
{
	//ShowCursor( TRUE );
}

/************************************************************************************************/
/*
 * 更新処理
 */
/************************************************************************************************/
void KsMouse::update()
{
	POINT		musPos;
	POINT		wndPos;
	KsInt32	data;

	/* カーソル位置 */
	musPos.x = 0;
	musPos.y = 0;
	wndPos.x = 0;
	wndPos.y = 0;

	GetCursorPos( &musPos );
	ClientToScreen( GetActiveWindow(), &wndPos ); 

	musPos.x -= wndPos.x; 
	musPos.y -= wndPos.y;

	m_x = musPos.x;
	m_y = musPos.y;

	/* ボタンチェック */
	/* 左右のマウスボタンの機能を交換しているかどうかをチェックする */
	//if( GetSystemMetrics( SM_SWAPBUTTON ) ){
		/* 交換してある */
	//}
	data = 0;

	if( GetAsyncKeyState( VK_LBUTTON ) & 0x8000 ){
		data |= ksMOUSE_BUTTON_LEFT;
	}
	if( GetAsyncKeyState( VK_RBUTTON ) & 0x8000 ){
		data |= ksMOUSE_BUTTON_RIGHT;
	}
	if( GetAsyncKeyState( VK_MBUTTON ) & 0x8000 ){
		data |= ksMOUSE_BUTTON_CENTER;
	}

	m_button_old = m_button_now;
	m_button_now = data;
	m_button_trg = ( m_button_now ^ m_button_old ) & m_button_now;
	m_button_off = ( m_button_now ^ m_button_old ) & m_button_old;
}


