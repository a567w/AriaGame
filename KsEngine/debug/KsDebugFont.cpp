/************************************************************************************************/
/** 
 * @file		KsDebugFont.h
 * @brief		文字列操作
 * @author		Tsukasa Kato
 * @date		2004/10/17
 * @since		2004/10/17
 * @version		1.0.0
 */
/************************************************************************************************/

/*==============================================================================================*/
/*                                 << インクルード >>                                            */
/*==============================================================================================*/
#include "KsEngine/KsEnginePreCompile.h"

/*==============================================================================================*/
/*                                     << 定義 >>                                               */
/*==============================================================================================*/

/*==============================================================================================*/
/*                                     << 宣言 >>                                               */
/*==============================================================================================*/

/************************************************************************************************/
/*
 * コンストラクタ
 */
/************************************************************************************************/
KsDebugFont::KsDebugFont()
{
	m_px    = 0;
	m_py    = 0;
	m_lineX = 10;
	m_lineY = 16;
	m_sizeX = 16;
	m_sizeY = 16;
}

/************************************************************************************************/
/*
 * 
 */
/************************************************************************************************/
KsDebugFont::~KsDebugFont()
{
}

/************************************************************************************************/
/*
 *
 */
/************************************************************************************************/
void KsDebugFont::draw( KsGraphics* pGraphics, KsTexture* pTexture )
{
	KsChar* p = &m_buffer[ 0 ];
	KsInt32 x = m_px;
	KsInt32 y = m_py;

	while( *p != '\0' )
	{
		if( *p & 0x80 )
		{
			break;
		}
		
		if( *p == '\n' )
		{
			y += m_lineY;
		}
		else
		{
			KsInt32	column = static_cast<KsInt32>(*p) % m_sizeX;	/* 列 */
			KsInt32	row    = static_cast<KsInt32>(*p) / m_sizeY;	/* 行 */

			const KsReal u0 = static_cast<KsReal>(column) * static_cast<KsReal>(m_sizeX)/255.0f;
			const KsReal v0 = static_cast<KsReal>(row)    * static_cast<KsReal>(m_sizeY)/255.0f;
			const KsReal u1 = u0 + static_cast<KsReal>(m_lineX)/255.0f;
			const KsReal v1 = v0 + static_cast<KsReal>(m_lineY)/255.0f;

			pGraphics->drawSprite( pTexture, x, y, m_lineX, m_lineY, u0, v0, u1, v1 );

			x += m_lineX;
		}

		++p;
	}
}

