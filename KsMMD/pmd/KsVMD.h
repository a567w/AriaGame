/************************************************************************************************/
/** 
 * @file		KsPMD.h
 * @brief		PMDファイル
 * @author		Tsukasa Kato
 * @date		2010/12/17
 * @since		----/--/--
 * @version		1.0.0
 */
/************************************************************************************************/
#ifndef __KSVMD_H__
#define __KSVMD_H__

/*==============================================================================================*/
/*                                 << インクルード >>                                          */
/*==============================================================================================*/

/*==============================================================================================*/
/*                                     << 定義 >>                                               */
/*==============================================================================================*/

/*==============================================================================================*/
/*                                     << 宣言 >>                                               */
/*==============================================================================================*/

#pragma pack( push, 1 )

/************************************************************************************************/
/**
 * @struct		KS_VMD_VECTOR3
 * @brief		Vector3
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_VECTOR3
{
	KsReal		x;
	KsReal		y;
	KsReal		z;
};

/************************************************************************************************/
/**
 * @struct		KS_VMD_VECTOR4
 * @brief		Vector4
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_VECTOR4
{
	KsReal		x;
	KsReal		y;
	KsReal		z;
	KsReal		w;
};


/************************************************************************************************/
/**
 * @struct		KS_VMD_HEADER
 * @brief		VMDヘッダ
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_HEADER
{
	KsInt8				Header[ 30 ];				// "Vocaloid Motion Data 0002"
	KsInt8				ModelName[ 20 ];			// 対象モデル名
};

/************************************************************************************************/
/**
 * @struct		KS_VMD_KEYFRAME
 * @brief		VMDキーフレームデータ
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_KEYFRAME
{
	KsInt8				BoneName[ 15 ];				// ボーン名
	KsUInt32			FrameNo;					// フレーム番号
	KS_VMD_VECTOR3		Position;					// 位置
	KS_VMD_VECTOR4		Rotation;					// 回転(クォータニオン)
	KsInt8				InterpolationX[ 16 ];		// 補間情報 X軸移動
	KsInt8				InterpolationY[ 16 ];		// 補間情報 Y軸移動
	KsInt8				InterpolationZ[ 16 ];		// 補間情報 Z軸移動
	KsInt8				InterpolationRot[ 16 ];		// 補間情報 回転
};

/************************************************************************************************/
/**
 * @struct		KS_VMD_FACE
 * @brief		モーフィング用データ
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_FACE
{
	KsInt8				FaceName[ 15 ];				// 表情名
	KsUInt32			FrameNo;					// フレーム番号
	KsReal				Factor;						// ブレンド率
};

/************************************************************************************************/
/**
 * @struct		KS_VMD_FACE
 * @brief		モーフィング用データ
 * @version		1.0.0
 */
/************************************************************************************************/
struct KS_VMD_DATA
{
	KS_VMD_HEADER		Header;
	KsUInt32			NumFrame;
	KS_VMD_KEYFRAME*	Frames;
	KsUInt32			NumFace;
	KS_VMD_FACE*		Faces;;
};

#pragma pack( pop )



/*************************************************************************************************/
/*
 * VMDファイル読み込み処理
 * @param	filePath	ファイルパス
 * @return	VMDファイルデータ
 */
/*************************************************************************************************/
ksMMD_API KS_VMD_DATA* KsLoadVMDFile( const KsString& filePath );

/*************************************************************************************************/
/*
 * アニメーションファイル読み込み処理
 * @param	filePath	ファイルパス
 * @return	アニメーション
 */
/*************************************************************************************************/
ksMMD_API KsAnimation*	KsAnimationCreateFromVMD( const KsString& filePath );

#endif /* __KSVMD_H__ */


